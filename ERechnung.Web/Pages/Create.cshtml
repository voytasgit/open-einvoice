@page
@model ERechnung.Web.Pages.CreateModel
@{
    ViewData["Title"] = "XRechnung erstellen";
}

@if (TempData.ContainsKey("Invoice"))
{
    <div class="alert alert-success mb-4">
        ✅ Daten aus importierter Rechnung übernommen
    </div>
}

<h1 class="mb-4">📄 XRechnung erstellen</h1>

<form method="post">

    <!-- ================= RECHNUNG ================= -->
    <div class="card mb-4 card-primary">
        <div class="card-header">
            🧾 Rechnungsdaten
        </div>
        <div class="card-body row g-3">

            <div class="col-md-4">
                <label class="form-label required">BuyerReference</label>
                <input asp-for="Invoice.Invoice.BuyerReference"
                       placeholder="z. B. Leitweg-ID / Kostenstelle"
                       class="form-control" />
            </div>

            <div class="col-md-4">
                <label class="form-label required">Rechnungsnummer</label>
                <input asp-for="Invoice.Invoice.InvoiceNumber" class="form-control" />
            </div>

            <div class="col-md-4">
                <label class="form-label required">Rechnungsdatum</label>
                <input asp-for="Invoice.Invoice.InvoiceDate"
                       type="date"
                       class="form-control" />
            </div>

            <div class="col-md-6">
                <label class="form-label required">Zahlungsbedingungen</label>
                <input asp-for="Invoice.Invoice.PaymentTerms" class="form-control" />
            </div>

            <!-- ================= PAYMENT ================= -->

            <div class="col-md-3">
                <label class="form-label required">Zahlungsart</label>
                <select asp-for="Invoice.Invoice.Payment.PaymentMeansCode"
                        class="form-select">
                    <option value="42">SEPA Überweisung</option>
                    <option value="10">Barzahlung</option>
                    <option value="48">Karte</option>
                </select>
            </div>

            <div class="col-md-6">
                <label class="form-label">IBAN</label>
                <input asp-for="Invoice.Invoice.Payment.Iban"
                       placeholder="DE00 0000 0000 0000 0000 00"
                       class="form-control" />
                <div class="form-text">
                    Nur erforderlich bei SEPA-Überweisung (Code 42)
                </div>
            </div>

        </div>

    </div>

    <!-- ================= POSITION ================= -->
    <div class="card mb-4">
        <div class="card-header">
            📦 Position
        </div>
        <div class="card-body row g-3">

            <div class="col-md-6">
                <label class="form-label required">Bezeichnung</label>
                <input asp-for="Invoice.Items[0].Name" class="form-control" />
            </div>

            <div class="col-md-6">
                <label class="form-label">Beschreibung</label>
                <input asp-for="Invoice.Items[0].Description" class="form-control" />
            </div>

            <div class="col-md-3">
                <label class="form-label required">Menge</label>
                <input asp-for="Invoice.Items[0].Quantity"
                       type="number"
                       step="0.01"
                       inputmode="decimal"
                       class="form-control text-end" />
            </div>

            <div class="col-md-3">
                <label class="form-label required">Einheit</label>
                <input asp-for="Invoice.Items[0].UnitCode"
                       class="form-control"
                       placeholder="z. B. C62" />
            </div>

            <div class="col-md-3">
                <label class="form-label required">Preis netto</label>
                <div class="input-group">
                    <input asp-for="Invoice.Items[0].UnitPriceNet"
                           type="number"
                           step="0.01"
                           inputmode="decimal"
                           class="form-control text-end" />
                    <span class="input-group-text">€</span>
                </div>
            </div>

            <div class="col-md-3">
                <label class="form-label required">MwSt</label>
                <div class="input-group">
                    <input asp-for="Invoice.Items[0].VatRate"
                           type="number"
                           step="0.01"
                           inputmode="decimal"
                           class="form-control text-end" />
                    <span class="input-group-text">%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= STAMMDATEN ================= -->
    <div class="accordion mb-4" id="partyAccordion">

        <!-- SELLER -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#sellerBlock">
                    🏢 Verkäufer
                </button>
            </h2>
            <div id="sellerBlock" class="accordion-collapse collapse show">
                <div class="accordion-body row g-3">

                    <div class="col-md-6">
                        <label class="form-label required">EndpointID</label>
                        <input asp-for="Invoice.Seller.EndpointId" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">Firmenname</label>
                        <input asp-for="Invoice.Seller.Name" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">USt-IdNr.</label>
                        <input asp-for="Invoice.Seller.VatId" class="form-control" />
                    </div>

                    <div class="col-md-8">
                        <label class="form-label required">Straße</label>
                        <input asp-for="Invoice.Seller.Street" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label required">PLZ</label>
                        <input asp-for="Invoice.Seller.PostalCode" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">Ort</label>
                        <input asp-for="Invoice.Seller.City" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">Land</label>
                        <input asp-for="Invoice.Seller.CountryCode" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">E-Mail</label>
                        <input asp-for="Invoice.Seller.Email" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Telefon</label>
                        <input asp-for="Invoice.Seller.Phone" class="form-control" />
                    </div>

                </div>
            </div>
        </div>

        <!-- BUYER -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#buyerBlock">
                    🏛 Käufer
                </button>
            </h2>
            <div id="buyerBlock" class="accordion-collapse collapse">
                <div class="accordion-body row g-3">

                    <div class="col-md-6">
                        <label class="form-label required">EndpointID</label>
                        <input asp-for="Invoice.Buyer.EndpointId" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">Firmenname</label>
                        <input asp-for="Invoice.Buyer.Name" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">E-Mail</label>
                        <input asp-for="Invoice.Buyer.Email" class="form-control" />
                    </div>

                    <div class="col-md-8">
                        <label class="form-label required">Straße</label>
                        <input asp-for="Invoice.Buyer.Street" class="form-control" />
                    </div>

                    <div class="col-md-4">
                        <label class="form-label required">PLZ</label>
                        <input asp-for="Invoice.Buyer.PostalCode" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">Ort</label>
                        <input asp-for="Invoice.Buyer.City" class="form-control" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label required">Land</label>
                        <input asp-for="Invoice.Buyer.CountryCode" class="form-control" />
                    </div>

                </div>
            </div>
        </div>

    </div>

    <!-- ================= ACTION ================= -->
    <div class="text-end mt-4">
        <button type="submit"
                asp-page-handler="Preview"
                class="btn btn-success btn-lg px-5">
            🔍 Vorschau anzeigen
        </button>
<!-- 
        <button class="btn btn-success btn-lg px-5">
            📥 XRechnung erzeugen
        </button>
        <p class="text-muted mt-2">
            Die XML-Datei wird nach dem Absenden direkt erzeugt.
        </p>
                -->
    </div>

</form>
